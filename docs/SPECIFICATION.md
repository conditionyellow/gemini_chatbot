# Gemini ChatBot アプリケーション仕様書

## 概要

このアプリケーションは、Google の Gemini API を利用した Web ベースのチャットボットシステムです。
Cloud Functions を経由して Gemini API と通信し、音声読み上げ機能を備えたインタラクティブなチャットインターフェースを提供します。

## 技術スタック

- **フロントエンド**: HTML, CSS, JavaScript (Vanilla JS)
- **Live2D**: Live2D Cubism SDK for Web
- **バックエンド**: Google Cloud Functions
- **AI モデル**: Google Gemini AI
- **音声合成**: Web Speech API (SpeechSynthesisUtterance)

## 主要機能

### 1. チャットインターフェース

#### 1.1 メッセージ入力
- テキスト入力フィールドによるメッセージ入力
- 送信ボタンまたは Enter キーによるメッセージ送信
- 送信中のボタン無効化による二重送信防止

#### 1.2 メッセージ表示
- ユーザーメッセージとボットメッセージの視覚的な区別
- 自動スクロールによる最新メッセージの表示
- 「思考中...」表示による処理状態の可視化

### 2. Live2Dキャラクター表示
- Live2Dモデルのロードとキャンバスへの描画
- （将来的な拡張）チャット内容や感情に応じたキャラクターの表情・モーション変化

### 3. 音声読み上げ機能

#### 3.1 基本設定
- 言語: 日本語 (ja-JP)
- 音量: 1.0 (最大)
- 読み上げ速度: 1.0 (標準)
- 音声の高さ: 1.0 (標準)

#### 3.2 制御機能
- 読み上げ中の音声の自動停止
- 新規メッセージ受信時の即時読み上げ開始

### 4. チャット履歴管理

#### 4.1 データ構造
```javascript
{
    role: string,  // 'user' または 'model'
    text: string   // メッセージ内容
}
```

#### 4.2 履歴の保持
- セッション中のチャット履歴をフロントエンドのメモリ上に保持
- API リクエスト時に過去のチャット履歴情報を送信（バックエンドでの文脈理解のため）

### 5. API 通信

#### 5.1 リクエスト形式
```javascript
{
    userMessage: string,     // 最新のユーザーメッセージ
    chatHistory: array       // 過去のチャット履歴
}
```

#### 5.2 エラーハンドリング
- ネットワークエラーの検出と表示
- API レスポンスエラーの処理
- エラー時のユーザーフレンドリーなメッセージ表示

### 6. AI ボットの応答特性 (ペルソナ設定)
- **専門分野**: 超高齢化社会の抱える問題
- **応答スタイル**:
    - 日本および世界の超高齢化社会問題に関する詳細な情報提供
    - 高齢者の健康、幸福、孤立化対策に関する積極的な応答
    - 常に丁寧語を使用し、語尾に「〜ですよ」「〜ですね」を多用
    - 回答にはエビデンスを提示
    - 個人的な意見や感想は控え、客観的な情報提供を重視
- **設定場所**: バックエンド (Cloud Functions) のシステム指示として設定

## セキュリティ考慮事項

### 1. API エンドポイント
- Cloud Functions による API キーの保護
- CORS 設定による許可された接続元の制限

### 2. 入力検証
- メッセージの空文字チェック
- 送信前のテキストのトリミング処理

## パフォーマンス最適化

### 1. UI/UX 最適化
- ボタンの状態管理による誤操作防止
- 処理中の視覚的フィードバック
- スムーズなスクロール動作

### 2. 通信最適化
- 不要なリクエストの防止
- エラー時の適切なリカバリー処理

## 拡張性

### 1. 設定可能なパラメータ
- `CLOUD_FUNCTION_URL`: API エンドポイントの URL
- 音声設定（言語、音量、速度、ピッチ）
- Live2Dモデルのパスおよびファイル名

### 2. 拡張可能な機能
- 音声認識機能の追加
- チャット履歴の永続化
- UI テーマのカスタマイズ
- Live2Dモデルの差し替え
- Live2Dキャラクターのモーション・表情パターンの追加

## 制限事項

1. チャット履歴はセッション中のみ保持（ブラウザリロードで消失）
2. 音声読み上げは最新のボットメッセージのみ
3. オフライン動作非対応
4. Live2Dモデルの初期ロードに若干時間を要する場合がある
5. 現状、Live2Dキャラクターのインタラクション（クリック反応など）は限定的

## 今後の改善点

1. チャット履歴の永続化対応（例: LocalStorage, IndexedDB）
2. 音声認識機能の実装
3. レスポンシブデザインの強化
4. 多言語対応の拡充
5. プログレッシブウェブアプリ（PWA）化
6. Live2Dキャラクターとのインタラクション強化（感情表現の自動連携、クリックイベント対応など）
7. Live2Dモデルの動的な切り替え機能