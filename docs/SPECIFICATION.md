# Gemini ChatBot アプリケーション仕様書

## 概要

このアプリケーションは、Google の Gemini API を利用した Web ベースのチャットボットシステムです。
Cloud Functions を経由して Gemini API と通信し、音声読み上げ機能を備えたインタラクティブなチャットインターフェースを提供します。

## 技術スタック

- **フロントエンド**: HTML, CSS, JavaScript (Vanilla JS)
- **バックエンド**: Google Cloud Functions
- **AI モデル**: Google Gemini AI
- **音声合成**: Web Speech API (SpeechSynthesisUtterance)

## 主要機能

### 1. チャットインターフェース

#### 1.1 メッセージ入力
- テキスト入力フィールドによるメッセージ入力
- 送信ボタンまたは Enter キーによるメッセージ送信
- 送信中のボタン無効化による二重送信防止

#### 1.2 メッセージ表示
- ユーザーメッセージとボットメッセージの視覚的な区別
- 自動スクロールによる最新メッセージの表示
- 「思考中...」表示による処理状態の可視化

### 2. 音声読み上げ機能

#### 2.1 基本設定
- 言語: 日本語 (ja-JP)
- 音量: 1.0 (最大)
- 読み上げ速度: 1.0 (標準)
- 音声の高さ: 1.0 (標準)

#### 2.2 制御機能
- 読み上げ中の音声の自動停止
- 新規メッセージ受信時の即時読み上げ開始

### 3. チャット履歴管理

#### 3.1 データ構造
```javascript
{
    role: string,  // 'user' または 'model'
    text: string   // メッセージ内容
}
```

#### 3.2 履歴の保持
- セッション中のチャット履歴をメモリ上に保持
- API リクエスト時に履歴情報を送信

### 4. API 通信

#### 4.1 リクエスト形式
```javascript
{
    userMessage: string,     // 最新のユーザーメッセージ
    chatHistory: array       // 過去のチャット履歴
}
```

#### 4.2 エラーハンドリング
- ネットワークエラーの検出と表示
- API レスポンスエラーの処理
- エラー時のユーザーフレンドリーなメッセージ表示

## セキュリティ考慮事項

### 1. API エンドポイント
- Cloud Functions による API キーの保護
- CORS 設定による許可された接続元の制限

### 2. 入力検証
- メッセージの空文字チェック
- 送信前のテキストのトリミング処理

## パフォーマンス最適化

### 1. UI/UX 最適化
- ボタンの状態管理による誤操作防止
- 処理中の視覚的フィードバック
- スムーズなスクロール動作

### 2. 通信最適化
- 不要なリクエストの防止
- エラー時の適切なリカバリー処理

## 拡張性

### 1. 設定可能なパラメータ
- `CLOUD_FUNCTION_URL`: API エンドポイントの URL
- 音声設定（言語、音量、速度、ピッチ）

### 2. 拡張可能な機能
- 音声認識機能の追加
- チャット履歴の永続化
- UI テーマのカスタマイズ

## 制限事項

1. チャット履歴はセッション中のみ保持
2. 音声読み上げは最新のメッセージのみ
3. オフライン動作非対応

## 今後の改善点

1. チャット履歴の永続化対応
2. 音声認識機能の実装
3. レスポンシブデザインの強化
4. 多言語対応の拡充
5. プログレッシブウェブアプリ（PWA）化